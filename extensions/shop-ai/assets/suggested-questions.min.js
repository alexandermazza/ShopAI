console.log("suggested-questions.js loaded");const SuggestedQuestions={async waitForJudgeMeReviews(e=2e4){let t=document.querySelectorAll(".jdgm-rev");return t.length>0?t:new Promise((t=>{let n=!1;const o=new MutationObserver((()=>{const e=document.querySelectorAll(".jdgm-rev");e.length>0&&(n=!0,o.disconnect(),t(e))}));o.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{if(!n){o.disconnect();const e=document.querySelectorAll(".jdgm-rev");t(e)}}),e)}))},async scrapeReviewContent(){let e="\nCustomer Reviews:\n",t=[];const n=await this.waitForJudgeMeReviews();if(n.length>0)n.forEach(((e,n)=>{if(n>=5)return;const o=e.querySelector(".jdgm-rev__rating"),s=e.querySelector(".jdgm-rev__author");let r="";const i=e.querySelector(".jdgm-rev__body p"),u=e.querySelector(".jdgm-rev__body");r=i&&i.textContent.trim()?i.textContent.trim():u&&u.textContent.trim()?u.textContent.trim():"Review Text Missing";const g=o&&(o.getAttribute("data-score")||o.textContent.trim())||"?",c=s?s.textContent.trim().replace(/\s+/g," "):"";t.push({rating:g,author:c,body:r})}));else{let e=document.querySelectorAll(".spr-review");0===e.length&&(e=document.querySelectorAll(".shopify-product-reviews .review")),e.length>0&&e.forEach(((e,n)=>{if(n>=5)return;const o=e.querySelector(".spr-review-rating, .review-rating"),s=e.querySelector(".spr-review-author, .review-author"),r=e.querySelector(".spr-review-content, .review-content"),i=o?o.textContent.trim().replace(/\s+/g," "):"?",u=s?s.textContent.trim().replace(/\s+/g," "):"",g=r?r.textContent.trim().replace(/\s+/g," "):"Review Text Missing";t.push({rating:i,author:u,body:g})}))}return 0===t.length?"\nCustomer Reviews: No reviews found on this page.\n":(t.forEach(((t,n)=>{e+=`- Review ${n+1}: Rating: ${t.rating}/5. ${t.author?"By: "+t.author+". ":""}Comment: "${t.body}"\n`})),e)},async waitForContextAndReviews(e,t=15e3){const n=Date.now();return new Promise(((o,s)=>{!function r(){const i=e.dataset.productContext,u=document.querySelectorAll(".jdgm-rev, .spr-review, .shopify-product-reviews .review");i&&i.trim().length>0&&u.length>0?o({ctx:i,reviews:u}):Date.now()-n>t?s(new Error("Timed out waiting for productContext and reviews")):setTimeout(r,250)}()}))},async onMount(e=document){console.log("SuggestedQuestions: onMount called for",e);const t=e.querySelector("#suggested-questions-container");if(console.log("SuggestedQuestions: suggestionsContainer:",t),!t)return;const n=e.getAttribute("data-language")||"en";t.innerHTML='<span class="loading-message">Loading suggestions...</span>';try{const{ctx:o}=await this.waitForContextAndReviews(e);console.log("SuggestedQuestions: context ready:",o);const s=`${o}\\n${await this.scrapeReviewContent()}`;console.log("SuggestedQuestions: combinedContext (full):",s),console.log("SuggestedQuestions: Combined context length:",s.length),console.log("SuggestedQuestions: Language:",n);const r=await fetch("/apps/proxy/resource-openai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:"getSuggestedQuestions",productContext:s,language:n})});if(console.log("SuggestedQuestions: API response status:",r.status),!r.ok){const e=await r.text();return t.innerHTML='<span class="error-message">Could not load suggestions.</span>',void console.log("SuggestedQuestions: API error body:",e)}const i=await r.json();console.log("SuggestedQuestions: API data:",i),i.suggestions&&i.suggestions.questions&&Array.isArray(i.suggestions.questions)&&i.suggestions.questions.length>0?(t.innerHTML="",i.suggestions.questions.forEach((n=>{const o=document.createElement("button");o.type="button",o.className="suggested-question-button",o.textContent=n,o.onclick=()=>{const t=e.querySelector(".search-input"),o=e.querySelector("form.ask-me-anything-form");t&&o&&(t.value=n,o.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0})))},t.appendChild(o)})),console.log("SuggestedQuestions: rendered buttons:",i.suggestions.questions.length)):(t.innerHTML='<span class="no-suggestions-message">No suggested questions found.</span>',console.log("SuggestedQuestions: No suggested questions found."))}catch(e){t.innerHTML='<span class="error-message">Could not load suggestions (context or reviews missing).</span>',console.log("SuggestedQuestions: error:",e)}}};window.SuggestedQuestions=SuggestedQuestions,document.addEventListener("shopify:section:load",(function(e){const t=e.detail.sectionId,n=document.getElementById(`shopify-section-${t}`);if(!n)return;const o=n.querySelector("#ask-me-anything");o&&SuggestedQuestions.onMount(o)})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("#ask-me-anything").forEach((e=>{SuggestedQuestions.onMount(e)}))}));