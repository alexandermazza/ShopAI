console.log("suggested-questions.js loaded");const SuggestedQuestions={async waitForJudgeMeReviews(e=2e4){let t=document.querySelectorAll(".jdgm-rev");return t.length>0?t:new Promise((t=>{let o=!1;const n=new MutationObserver((()=>{const e=document.querySelectorAll(".jdgm-rev");e.length>0&&(o=!0,n.disconnect(),t(e))}));n.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{if(!o){n.disconnect();const e=document.querySelectorAll(".jdgm-rev");t(e)}}),e)}))},async scrapeReviewContent(){let e="\nCustomer Reviews:\n",t=[];const o=await this.waitForJudgeMeReviews();if(o.length>0)o.forEach(((e,o)=>{if(o>=5)return;const n=e.querySelector(".jdgm-rev__rating"),s=e.querySelector(".jdgm-rev__author");let r="";const i=e.querySelector(".jdgm-rev__body p"),u=e.querySelector(".jdgm-rev__body");r=i&&i.textContent.trim()?i.textContent.trim():u&&u.textContent.trim()?u.textContent.trim():"Review Text Missing";const g=n&&(n.getAttribute("data-score")||n.textContent.trim())||"?",c=s?s.textContent.trim().replace(/\s+/g," "):"";t.push({rating:g,author:c,body:r})}));else{let e=document.querySelectorAll(".spr-review");0===e.length&&(e=document.querySelectorAll(".shopify-product-reviews .review")),e.length>0&&e.forEach(((e,o)=>{if(o>=5)return;const n=e.querySelector(".spr-review-rating, .review-rating"),s=e.querySelector(".spr-review-author, .review-author"),r=e.querySelector(".spr-review-content, .review-content"),i=n?n.textContent.trim().replace(/\s+/g," "):"?",u=s?s.textContent.trim().replace(/\s+/g," "):"",g=r?r.textContent.trim().replace(/\s+/g," "):"Review Text Missing";t.push({rating:i,author:u,body:g})}))}return 0===t.length?"\nCustomer Reviews: No reviews found on this page.\n":(t.forEach(((t,o)=>{e+=`- Review ${o+1}: Rating: ${t.rating}/5. ${t.author?"By: "+t.author+". ":""}Comment: "${t.body}"\n`})),e)},async waitForContextAndReviews(e,t=5e3){const o=Date.now();return new Promise(((n,s)=>{!function r(){const i=e.dataset.productContext,u=document.querySelectorAll(".jdgm-rev, .spr-review, .shopify-product-reviews .review");i&&i.trim().length>0?n({ctx:i,reviews:u}):Date.now()-o>t?s(new Error("Timed out waiting for productContext")):setTimeout(r,250)}()}))},async onMount(e=document){console.log("SuggestedQuestions: onMount called for",e);const t=e.querySelector("#suggested-questions-container");if(!t)return void console.log("SuggestedQuestions: suggestionsContainer not found. Exiting onMount.");console.log("SuggestedQuestions: suggestionsContainer:",t);const o=e.getAttribute("data-language")||"en";t.innerHTML='<span class="loading-message">Loading suggestions...</span>';try{const{ctx:n}=await this.waitForContextAndReviews(e);console.log("SuggestedQuestions: context ready:",n);const s=`${n}\\n${await this.scrapeReviewContent()}`;console.log("SuggestedQuestions: combinedContext (full):",s),console.log("SuggestedQuestions: Combined context length:",s.length),console.log("SuggestedQuestions: Language:",o);const r=await fetch("/apps/proxy/resource-openai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:"getSuggestedQuestions",productContext:s,language:o,shop:window.Shopify?.shop||""})});if(console.log("SuggestedQuestions: API response status:",r.status),!r.ok){const e=await r.text();return t.innerHTML='<span class="error-message">Could not load suggestions.</span>',void console.log("SuggestedQuestions: API error body:",e)}const i=await r.json();console.log("SuggestedQuestions: API data:",i),i.suggestions&&i.suggestions.questions&&Array.isArray(i.suggestions.questions)&&i.suggestions.questions.length>0?(t.innerHTML="",i.suggestions.questions.forEach((o=>{const n=document.createElement("button");n.type="button",n.className="suggested-question-button",n.textContent=o,n.onclick=()=>{const n=e.querySelector(".search-input"),s=e.querySelector("form.ask-me-anything-form"),r=e.querySelector(".response-area");n&&s&&t&&r&&(n.value=o,s.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0})),r.parentNode.insertBefore(t,r.nextSibling))},t.appendChild(n)})),console.log("SuggestedQuestions: rendered buttons:",i.suggestions.questions.length)):(t.innerHTML='<span class="no-suggestions-message">No suggested questions found.</span>',console.log("SuggestedQuestions: No suggested questions found."))}catch(e){t.innerHTML='<span class="error-message">Could not load suggestions (product info missing).</span>',console.log("SuggestedQuestions: error:",e)}}};window.SuggestedQuestions=SuggestedQuestions,document.addEventListener("shopify:section:load",(function(e){const t=e.detail.sectionId,o=document.getElementById(`shopify-section-${t}`);if(!o)return;const n=o.querySelector("#ask-me-anything");n&&SuggestedQuestions.onMount(n)})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("#ask-me-anything").forEach((e=>{SuggestedQuestions.onMount(e)}))}));