console.log("suggested-questions.js loaded");const SuggestedQuestions={async waitForJudgeMeReviews(e=2e3){let t=document.querySelectorAll(".jdgm-rev");return t.length>0?t:new Promise(t=>{let o=!1;const s=new MutationObserver(()=>{const e=document.querySelectorAll(".jdgm-rev");e.length>0&&(o=!0,s.disconnect(),t(e))});s.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{if(!o){s.disconnect();const e=document.querySelectorAll(".jdgm-rev");t(e)}},e)})},async scrapeReviewContent(){let e="\nCustomer Reviews:\n",t=[];const o=await this.waitForJudgeMeReviews();if(o.length>0)o.forEach((e,o)=>{if(o>=5)return;const s=e.querySelector(".jdgm-rev__rating"),n=e.querySelector(".jdgm-rev__author");let r="";const i=e.querySelector(".jdgm-rev__body p"),g=e.querySelector(".jdgm-rev__body");r=i&&i.textContent.trim()?i.textContent.trim():g&&g.textContent.trim()?g.textContent.trim():"Review Text Missing";const u=s&&(s.getAttribute("data-score")||s.textContent.trim())||"?",c=n?n.textContent.trim().replace(/\s+/g," "):"";t.push({rating:u,author:c,body:r})});else{let e=document.querySelectorAll(".spr-review");0===e.length&&(e=document.querySelectorAll(".shopify-product-reviews .review")),e.length>0&&e.forEach((e,o)=>{if(o>=5)return;const s=e.querySelector(".spr-review-rating, .review-rating"),n=e.querySelector(".spr-review-author, .review-author"),r=e.querySelector(".spr-review-content, .review-content"),i=s?s.textContent.trim().replace(/\s+/g," "):"?",g=n?n.textContent.trim().replace(/\s+/g," "):"",u=r?r.textContent.trim().replace(/\s+/g," "):"Review Text Missing";t.push({rating:i,author:g,body:u})})}return 0===t.length?"\nCustomer Reviews: No reviews found on this page.\n":(t.forEach((t,o)=>{e+=`- Review ${o+1}: Rating: ${t.rating}/5. ${t.author?"By: "+t.author+". ":""}Comment: "${t.body}"\n`}),e)},async waitForContextAndReviews(e,t=1e3){const o=Date.now();return new Promise((s,n)=>{!function r(){const i=e.dataset.productContext,g=document.querySelectorAll(".jdgm-rev, .spr-review, .shopify-product-reviews .review");i&&i.trim().length>0?s({ctx:i,reviews:g}):Date.now()-o>t?n(new Error("Timed out waiting for productContext")):setTimeout(r,100)}()})},async onMount(e=document){console.log("SuggestedQuestions: onMount called for",e);const t=e.querySelector("#suggested-questions-container");if(!t)return void console.log("SuggestedQuestions: suggestionsContainer not found. Exiting onMount.");console.log("SuggestedQuestions: suggestionsContainer:",t);const o=e.getAttribute("data-language")||"en",s=e.dataset.productImages||"",n=s?s.split(",").filter(e=>e.trim()):[];console.log("🔍 === SUGGESTED QUESTIONS IMAGE DEBUG ==="),console.log("📄 Raw productImages data:",s),console.log("📸 Product images found:",n.length),n.length>0?console.log("🖼️  Image URLs:",n):console.log("❌ No product images detected for suggestions"),console.log("🔍 === END SUGGESTIONS IMAGE DEBUG ==="),t.innerHTML='<span class="loading-message">Loading suggestions...</span>';try{const{ctx:s}=await this.waitForContextAndReviews(e);console.log("SuggestedQuestions: context ready:",s);const r=`${s}\\n${await this.scrapeReviewContent()}`;console.log("SuggestedQuestions: combinedContext (full):",r),console.log("SuggestedQuestions: Combined context length:",r.length),console.log("SuggestedQuestions: Language:",o),console.log("📸 SuggestedQuestions: Product images found:",n.length);const i={operation:"getSuggestedQuestions",productContext:r,language:o,shop:window.Shopify?.shop||""};n.length>0?(i.productImages=n,console.log("📤 ===== SENDING IMAGES FOR SUGGESTIONS ====="),console.log("📤 SuggestedQuestions: Sending",n.length,"images for analysis"),console.log("📤 Image URLs being sent:",n),console.log("📤 ===== END SUGGESTIONS IMAGE SEND =====")):console.log("📤 SuggestedQuestions: No images to send - using text-only analysis");const g=await fetch("/apps/proxy/resource-openai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(console.log("SuggestedQuestions: API response status:",g.status),!g.ok){const e=await g.text();return t.innerHTML='<span class="error-message">Could not load suggestions.</span>',void console.log("SuggestedQuestions: API error body:",e)}const u=await g.json();console.log("SuggestedQuestions: API data:",u),u.suggestions&&u.suggestions.questions&&Array.isArray(u.suggestions.questions)&&u.suggestions.questions.length>0?(t.innerHTML="",u.suggestions.questions.forEach(o=>{const s=document.createElement("button");s.type="button",s.className="suggested-question-button",s.textContent=o,s.onclick=()=>{const s=e.querySelector(".search-input"),n=e.querySelector("form.ask-me-anything-form"),r=e.querySelector(".response-area");s&&n&&t&&r&&(s.value=o,n.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0})),r.parentNode.insertBefore(t,r.nextSibling))},t.appendChild(s)}),console.log("SuggestedQuestions: rendered buttons:",u.suggestions.questions.length)):(t.innerHTML='<span class="no-suggestions-message">No suggested questions found.</span>',console.log("SuggestedQuestions: No suggested questions found."))}catch(e){t.innerHTML='<span class="error-message">Could not load suggestions (product info missing).</span>',console.log("SuggestedQuestions: error:",e)}}};window.SuggestedQuestions=SuggestedQuestions,document.addEventListener("shopify:section:load",function(e){const t=e.detail.sectionId,o=document.getElementById(`shopify-section-${t}`);if(!o)return;const s=o.querySelector("#ask-me-anything");s&&SuggestedQuestions.onMount(s)}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("#ask-me-anything").forEach(e=>{SuggestedQuestions.onMount(e)})});