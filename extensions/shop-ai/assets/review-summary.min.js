"use strict";(()=>{var d={async waitForJudgeMeReviews(t=2e4){let r=document.querySelectorAll(".jdgm-rev");return r.length>0?r:new Promise(s=>{let e=!1,n=new MutationObserver(()=>{let i=document.querySelectorAll(".jdgm-rev");i.length>0&&(e=!0,n.disconnect(),s(i))});n.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{if(!e){n.disconnect();let i=document.querySelectorAll(".jdgm-rev");s(i)}},t)})},async scrapeReviewContent(){let t=[],r=await this.waitForJudgeMeReviews();if(r.length>0)r.forEach((e,n)=>{if(n>=10)return;let i=e.querySelector(".jdgm-rev__rating"),o=e.querySelector(".jdgm-rev__body p"),l=e.querySelector(".jdgm-rev__body"),a="";o&&o.textContent.trim()?a=o.textContent.trim():l&&l.textContent.trim()&&(a=l.textContent.trim());let c=i&&(i.getAttribute("data-score")||i.textContent.trim())||"?";a&&t.push(`Rating: ${c}/5 - Comment: "${a}"`)});else{let e=document.querySelectorAll(".spr-review");e.length===0&&(e=document.querySelectorAll(".shopify-product-reviews .review")),e.length>0&&e.forEach((n,i)=>{if(i>=10)return;let o=n.querySelector(".spr-review-rating, .review-rating"),l=n.querySelector(".spr-review-content, .review-content"),a=o?o.textContent.trim().replace(/\s+/g," "):"?",c=l?l.textContent.trim().replace(/\s+/g," "):"";c&&t.push(`Rating: ${a}/5 - Comment: "${c}"`)})}return t.length===0?null:t.join(`
`)},async onMount(t=document){if(!t||t.id!=="review-summary-block"){console.error("ReviewSummary: Invalid containerElement passed to onMount:",t);return}let r=t.querySelector(".summary-response-area"),s=r?.querySelector(".ai-summary-content"),e=r?.querySelector(".summary-attribution");if(!r||!s||!e){console.error("ReviewSummary: Missing required elements."),r||console.error(">>> ReviewSummary: responseArea missing"),s||console.error(">>> ReviewSummary: summaryContentElement missing"),e||console.error(">>> ReviewSummary: attributionElement missing"),t.style.display="none";return}let n=await this.scrapeReviewContent();if(console.log("ReviewSummary: scrapedReviews to send:",n),!n){t.style.display="none";return}console.log(">>> ReviewSummary: Elements Check:",{containerElement:t,summaryContentElement:s,responseArea:r,attributionElement:e}),t.classList.add("visible"),s.textContent="",r.classList.remove("error"),r.classList.add("loading"),e.classList.add("hidden");let i="/apps/proxy/resource-review-summary";console.log(">>> ReviewSummary: BEFORE fetch call");try{let o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scrapedReviews:n})});if(console.log(">>> ReviewSummary: AFTER fetch call, Status:",o.status),console.log(`>>> ReviewSummary: Response status: ${o.status}, ok: ${o.ok}`),!o.ok)throw console.error(">>> ReviewSummary: Response not OK",o.status,o.statusText),new Error(`API Error: ${o.status}`);console.log(">>> ReviewSummary: Receiving non-streamed JSON response..."),s.textContent="",r.classList.remove("loading"),t.classList.add("loaded");let l=o.headers.get("content-type");console.log(">>> ReviewSummary: Response Content-Type:",l);let a="Sorry, could not parse the summary.";console.log(">>> ReviewSummary: BEFORE response.json()");try{let c=await o.json();console.log(">>> ReviewSummary: AFTER response.json(), Data:",c),c&&typeof c.summary=="string"?a=c.summary:(console.error(">>> ReviewSummary: Invalid data structure",c),a="Error: Invalid response format.",r.classList.add("error"))}catch(c){console.error(">>> ReviewSummary: Error parsing JSON response:",c);try{let m=await o.text();console.warn(">>> ReviewSummary: Displaying raw text due to JSON parse error:",m),a=m}catch(m){console.error(">>> ReviewSummary: Failed to get raw text after JSON parse error:",m),a="Error loading summary."}r.classList.add("error")}s.textContent=a,r.classList.contains("error")?e.classList.add("hidden"):e.classList.remove("hidden")}catch(o){console.error(">>> ReviewSummary: CATCH BLOCK error:",o),s.textContent=`Error: ${o.message||"Could not load summary."}`,r.classList.remove("loading"),r.classList.add("error"),t.classList.add("loaded"),e.classList.add("hidden")}finally{console.log(">>> ReviewSummary: FINALLY block reached")}}};window.ReviewSummary=d;document.addEventListener("shopify:section:load",function(t){let r=t.detail.sectionId,s=document.getElementById(`shopify-section-${r}`);if(!s)return;let e=s.querySelector("#review-summary-block");e&&e.dataset.initialized!=="true"&&(d.onMount(e),e.dataset.initialized="true")});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('#review-summary-block:not([data-initialized="true"])').forEach(t=>{d.onMount(t),t.dataset.initialized="true"})});})();
