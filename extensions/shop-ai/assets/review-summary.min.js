const ReviewSummary={async waitForJudgeMeReviews(e=2e4){let t=document.querySelectorAll(".jdgm-rev");return t.length>0?t:new Promise((t=>{let o=!1;const r=new MutationObserver((()=>{const e=document.querySelectorAll(".jdgm-rev");e.length>0&&(o=!0,r.disconnect(),t(e))}));r.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{if(!o){r.disconnect();const e=document.querySelectorAll(".jdgm-rev");t(e)}}),e)}))},async scrapeReviewContent(){let e=[];const t=await this.waitForJudgeMeReviews();if(t.length>0)t.forEach(((t,o)=>{if(o>=10)return;const r=t.querySelector(".jdgm-rev__rating"),n=t.querySelector(".jdgm-rev__body p"),s=t.querySelector(".jdgm-rev__body");let a="";n&&n.textContent.trim()?a=n.textContent.trim():s&&s.textContent.trim()&&(a=s.textContent.trim());const i=r&&(r.getAttribute("data-score")||r.textContent.trim())||"?";a&&e.push(`Rating: ${i}/5 - Comment: "${a}"`)}));else{let t=document.querySelectorAll(".spr-review");0===t.length&&(t=document.querySelectorAll(".shopify-product-reviews .review")),t.length>0&&t.forEach(((t,o)=>{if(o>=10)return;const r=t.querySelector(".spr-review-rating, .review-rating"),n=t.querySelector(".spr-review-content, .review-content"),s=r?r.textContent.trim().replace(/\s+/g," "):"?",a=n?n.textContent.trim().replace(/\s+/g," "):"";a&&e.push(`Rating: ${s}/5 - Comment: "${a}"`)}))}if(0===e.length)return null;return e.join("\n")},async onMount(e=document){if(console.log("ReviewSummary: onMount called for container:",e),!e||"review-summary-block"!==e.id)return void console.error("ReviewSummary: Invalid containerElement passed to onMount:",e);console.log("ReviewSummary: Container validated, proceeding with initialization");const t=e.querySelector(".summary-response-area"),o=t?.querySelector(".ai-summary-content"),r=t?.querySelector(".summary-attribution");if(!t||!o||!r)return console.error("ReviewSummary: Missing required elements."),t||console.error(">>> ReviewSummary: responseArea missing"),o||console.error(">>> ReviewSummary: summaryContentElement missing"),r||console.error(">>> ReviewSummary: attributionElement missing"),e.classList.add("visible"),e.classList.add("loaded"),void(o&&(o.textContent="Configuration error. Reach out to info@shop-ai.co to resolve any issues.",t&&t.classList.add("error")));const n=await this.scrapeReviewContent();let s="default";if(e&&e.hasAttribute("data-block-settings"))try{const t=JSON.parse(e.getAttribute("data-block-settings"));t&&t.tone_of_voice&&(s=t.tone_of_voice)}catch(e){console.warn("ReviewSummary: Failed to parse data-block-settings for tone_of_voice:",e)}if(console.log("ReviewSummary: scrapedReviews to send:",n,"toneOfVoice:",s),e.classList.add("visible"),o.textContent="",t.classList.remove("error"),r.classList.add("hidden"),!n)return console.log("ReviewSummary: No reviews found, showing error message."),console.log("ReviewSummary: Setting error text and adding error class"),o.textContent="No reviews detected. Reach out to info@shop-ai.co to resolve any issues.",t.classList.add("error"),e.classList.add("loaded"),console.log("ReviewSummary: Error message set. Content:",o.textContent),void console.log("ReviewSummary: Response area classes:",t.className);console.log(">>> ReviewSummary: Elements Check:",{containerElement:e,summaryContentElement:o,responseArea:t,attributionElement:r}),t.classList.add("loading");console.log(">>> ReviewSummary: BEFORE fetch call");try{const a=await fetch("/apps/proxy/resource-review-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scrapedReviews:n,toneOfVoice:"default"!==s?s:void 0})});if(console.log(">>> ReviewSummary: AFTER fetch call, Status:",a.status),console.log(`>>> ReviewSummary: Response status: ${a.status}, ok: ${a.ok}`),!a.ok)throw console.error(">>> ReviewSummary: Response not OK",a.status,a.statusText),new Error(`API Error: ${a.status}`);console.log(">>> ReviewSummary: Receiving non-streamed JSON response..."),o.textContent="",t.classList.remove("loading"),e.classList.add("loaded");const i=a.headers.get("content-type");console.log(">>> ReviewSummary: Response Content-Type:",i);let l="Sorry, could not parse the summary.";console.log(">>> ReviewSummary: BEFORE response.json()");try{const e=await a.json();console.log(">>> ReviewSummary: AFTER response.json(), Data:",e),e&&"string"==typeof e.summary?l=e.summary:(console.error(">>> ReviewSummary: Invalid data structure",e),l="Error: Invalid response format.",t.classList.add("error"))}catch(e){console.error(">>> ReviewSummary: Error parsing JSON response:",e);try{const e=await a.text();console.warn(">>> ReviewSummary: Displaying raw text due to JSON parse error:",e),l=e}catch(e){console.error(">>> ReviewSummary: Failed to get raw text after JSON parse error:",e),l="Error loading summary."}t.classList.add("error")}o.textContent="",o.classList.remove("animate-text-reveal"),o.textContent=l,t.classList.contains("error")?r.classList.add("hidden"):(o.classList.add("animate-text-reveal"),r.classList.remove("hidden"))}catch(n){console.error(">>> ReviewSummary: CATCH BLOCK error:",n),o.textContent=`Error: ${n.message||"Could not load summary."}`,t.classList.remove("loading"),t.classList.add("error"),e.classList.add("loaded"),r.classList.add("hidden")}finally{console.log(">>> ReviewSummary: FINALLY block reached")}}};window.ReviewSummary=ReviewSummary,document.addEventListener("shopify:section:load",(function(e){const t=e.detail.sectionId,o=document.getElementById(`shopify-section-${t}`);if(!o)return;const r=o.querySelector("#review-summary-block");r&&"true"!==r.dataset.initialized&&(ReviewSummary.onMount(r),r.dataset.initialized="true")})),document.addEventListener("DOMContentLoaded",(()=>{console.log("ReviewSummary: DOMContentLoaded event fired - looking for review blocks.");const e=document.querySelectorAll('#review-summary-block:not([data-initialized="true"])');console.log("ReviewSummary: Found blocks:",e.length),e.forEach((e=>{console.log("ReviewSummary: Initializing component via DOMContentLoaded for block:",e),ReviewSummary.onMount(e),e.dataset.initialized="true"}))}));
//# sourceMappingURL=review-summary.min.js.map